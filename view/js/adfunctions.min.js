!function(){let e,t,a,d,l;function i(){return d}function r(a,d){$.ajax({url:"./view/ajax/productos.php",method:"POST",data:{id:a,action:"modalUpdate"}}).done(function(a){t=JSON.parse(a),"editar"==d?s(e):function e(){let a=document.createElement("div");a.classList.add("modal","fade"),a.id="staticBackdrop",a.setAttribute("data-bs-backdrop","static"),a.setAttribute("data-bs-keyboard","false"),a.setAttribute("tabindex","-1"),a.setAttribute("aria-labelledby","staticBackdropLabel"),a.setAttribute("aria-hidden","true");let d=document.createElement("div");d.classList.add("modal-dialog","modal-dialog-centered","modal-dialog-scrollable");let l=document.createElement("div");l.classList.add("modal-content");let i=document.createElement("div");i.classList.add("modal-header");let r=document.createElement("h1");r.classList.add("modal-title","fs-5"),r.id="staticBackdropLabel",r.textContent="Eliminar Producto";let s=document.createElement("button");s.type="button",s.classList.add("btn-close"),s.setAttribute("data-bs-dismiss","modal"),s.setAttribute("aria-label","Close"),s.addEventListener("click",C);let n=document.createElement("div");n.classList.add("modal-body");let o=document.createElement("form");o.setAttribute("method","POST");let c=document.createElement("input");c.classList.add("form-control"),c.setAttribute("type","hidden"),c.setAttribute("name","idd"),c.id="idd",c.value=t[0].idproducto;let p=document.createElement("div");p.id="alerta";let u=document.createElement("div");u.classList.add("mb-3"),u.innerHTML="\xbfSeguro que deseas eliminar el producto?";let m=document.createElement("div");m.classList.add("modal-footer");let b=document.createElement("button");b.type="button",b.classList.add("btn","btn-secondary"),b.setAttribute("data-bs-dismiss","modal"),b.textContent="Cancelar",b.addEventListener("click",C);let h=document.createElement("button");h.classList.add("btn","btn-danger"),h.textContent="Eliminar",h.id="btn-delete",i.appendChild(r),i.appendChild(s),m.appendChild(b),m.appendChild(h),l.appendChild(i),l.appendChild(n),n.appendChild(o),o.appendChild(c),o.appendChild(u),o.appendChild(m),o.appendChild(p),d.appendChild(l),a.appendChild(d),document.body.appendChild(a);let f=new bootstrap.Modal(a);function C(){f.hide(),document.body.removeChild(a)}f.show(),$("#btn-delete").click(function(){!function e(){event.preventDefault();let t=document.getElementById("idd").value;fetch("./view/ajax/crudproducto.php",{method:"POST",body:new URLSearchParams({action:"delete",idd:t})}).then(e=>e.text()).then(e=>{document.getElementById("alerta").innerHTML=e,f.hide(),document.body.removeChild(a),$("#table-productos").DataTable().ajax.reload()}).catch(e=>console.error("Error:",e))}()})}()})}function s(e){let d=document.createElement("div");d.classList.add("modal","fade"),d.id="staticBackdrop",d.setAttribute("data-bs-backdrop","static"),d.setAttribute("data-bs-keyboard","false"),d.setAttribute("tabindex","-1"),d.setAttribute("aria-labelledby","staticBackdropLabel"),d.setAttribute("aria-hidden","true");let i=document.createElement("div");i.classList.add("modal-dialog","modal-dialog-centered","modal-dialog-scrollable");let r=document.createElement("div");r.classList.add("modal-content");let s=document.createElement("div");s.classList.add("modal-header");let n=document.createElement("h1");n.classList.add("modal-title","fs-5"),n.id="staticBackdropLabel","agregar"==e?n.textContent="Agregar Producto":"editar"==e&&(n.textContent="Actualizar Producto");let o=document.createElement("button");o.type="button",o.classList.add("btn-close"),o.setAttribute("data-bs-dismiss","modal"),o.setAttribute("aria-label","Close"),o.addEventListener("click",F);let c=document.createElement("div");c.classList.add("modal-body");let p=document.createElement("form");p.setAttribute("method","POST"),p.setAttribute("action","./view/ajax/crudproducto.php"),p.classList.add("ProductosAjax"),"agregar"==e?p.setAttribute("data-form","add-producto"):"editar"==e&&p.setAttribute("data-form","up-producto"),p.setAttribute("enctype","multipart/form-data");let u=document.createElement("input");u.classList.add("form-control"),u.setAttribute("type","hidden"),u.setAttribute("name","uppid"),"editar"==e&&(u.value=t[0].idproducto);let m=document.createElement("div");m.classList.add("mb-3");let b=document.createElement("label");b.setAttribute("for","categoria"),b.classList.add("col-form-label");let h=document.createTextNode("Categoria");b.appendChild(h);let f=document.createElement("select");f.classList.add("form-select"),f.setAttribute("name","categoria"),f.id="selectModal","editar"==e&&(a=t[0].idcategoria),fetch("./view/ajax/productos.php",{method:"POST",body:new URLSearchParams({action:"datosSelect"})}).then(e=>e.json()).then(t=>{var d;t.forEach(e=>{let t=document.createElement("option");t.textContent=e.nombre,t.value=e.idcategoria,f.appendChild(t)}),"editar"==e&&(d=a,$.ajax({url:"./view/ajax/productos.php",method:"POST",data:{idcat:d,action:"categoriaSelect"}}).then(function(e){return JSON.parse(e)})).then(function(e){let t=document.getElementById("selectModal");for(let a=0;a<t.options.length;a++)if(t.options[a].value==e[0].idcategoria){t.selectedIndex=a;break}})}).catch(e=>console.error(e));let C=document.createElement("div");C.classList.add("mb-3");let E=document.createElement("label");E.setAttribute("for","nombre"),E.classList.add("col-form-label");let v=document.createTextNode("Nombre");E.appendChild(v);let L=document.createElement("input");L.setAttribute("type","text"),L.classList.add("form-control"),"editar"==e?L.setAttribute("name","nombre"):L.setAttribute("name","addpname"),L.id="nombre","editar"==e&&(L.value=t[0].nombre);let A=document.createElement("div");A.classList.add("mb-3");let g=document.createElement("label");g.setAttribute("for","descripcion"),g.classList.add("col-form-label");let x=document.createTextNode("Descripcion");g.appendChild(x);let y=document.createElement("textarea");y.classList.add("form-control"),y.setAttribute("name","descripcion"),y.id="descripcion","editar"==e&&(y.value=t[0].descripcion);let k=document.createElement("div");k.classList.add("mb-3");let w=document.createElement("label");w.setAttribute("for","precio"),w.classList.add("col-form-label");let j=document.createTextNode("Precio");w.appendChild(j);let T=document.createElement("input");T.setAttribute("type","text"),T.classList.add("form-control"),T.setAttribute("name","precio"),T.id="precio","editar"==e&&(T.value=t[0].precio);let _=document.createElement("div");_.classList.add("mb-3");let P=document.createElement("label");P.setAttribute("for","stock"),P.classList.add("col-form-label");let B=document.createTextNode("stock");P.appendChild(B);let S=document.createElement("input");S.setAttribute("type","text"),S.classList.add("form-control"),S.setAttribute("name","stock"),S.id="stock","editar"==e&&(S.value=t[0].stock);let M,N,O,D;"editar"==e&&(rutaImagen=t[0].imagen,M="view/",(N=document.createElement("div")).classList.add("mb-3","d-flex","justify-content-center"),(O=document.createElement("img")).setAttribute("width","200px"),D=M?M+rutaImagen:rutaImagen,O.src=D);let q=document.createElement("div");q.classList.add("mb-3");let z=document.createElement("label");z.setAttribute("for","imagen"),z.classList.add("col-form-label");let I=document.createTextNode("Imagen");z.appendChild(I);let H=document.createElement("input");H.setAttribute("type","file"),H.classList.add("form-control"),H.setAttribute("name","imagen"),H.id="imagen";let R=document.createElement("div");R.classList.add("RespuestaAjax");let G=document.createElement("div");G.classList.add("modal-footer");let Q=document.createElement("button");Q.type="button",Q.classList.add("btn","btn-secondary"),Q.setAttribute("data-bs-dismiss","modal"),Q.textContent="Cancelar",Q.addEventListener("click",F);let U=document.createElement("button");U.classList.add("btn","btn-primary"),U.textContent="Guardar",s.appendChild(n),s.appendChild(o),G.appendChild(Q),G.appendChild(U),r.appendChild(s),r.appendChild(c),c.appendChild(p),"editar"==e&&p.appendChild(u),p.appendChild(m),m.appendChild(b),m.appendChild(f),p.appendChild(C),C.appendChild(E),C.appendChild(L),p.appendChild(A),A.appendChild(g),A.appendChild(y),p.appendChild(k),k.appendChild(w),k.appendChild(T),p.appendChild(_),_.appendChild(P),_.appendChild(S),"editar"==e&&(p.appendChild(N),N.appendChild(O)),p.appendChild(q),q.appendChild(z),q.appendChild(H),p.appendChild(G),p.appendChild(R),i.appendChild(r),d.appendChild(i),document.body.appendChild(d);let X=new bootstrap.Modal(d);function F(){X.hide(),document.body.removeChild(d)}X.show(),$(".ProductosAjax").submit(function(e){e.preventDefault();var t,a=$(this),d=a.attr("data-form"),i=a.attr("action"),r=a.attr("method"),s=a.children(".RespuestaAjax"),n=new FormData(this);t="add-producto"===d?"Los datos que enviaras quedaran almacenados en el sistema":"delete"==d?"Los datos ser\xe1n eliminados completamente del sistema":"up-producto"===d?"Los datos del sistema ser\xe1n actualizados":"generate"===d?"Se va a generar un nuevo usuario":"disabled"===d?"El usuario ser\xe1 desabilitado del sistema":"enable"===d?"El usuario ser\xe1 habilitado del sistema":"update-perfil"===d?"Los datos del sistema ser\xe1n actualizados":"Quieres realizar la operaci\xf3n solicitada",Swal.fire({title:"\xbfEst\xe1s seguro?",text:t,icon:"question",showCancelButton:!0,confirmButtonText:"Aceptar",cancelButtonText:"Cancelar"}).then(e=>{if(e.isConfirmed)return $.ajax({type:r,url:i,data:n||a.serialize(),cache:!1,contentType:!1,processData:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;(t=parseInt(100*t))<100?s.append('<p class="text-center">Procesado... ('+t+'%)</p><div class="progress progress-striped active"><div class="progress-bar progress-bar-info" style="width: '+t+'%;"></div></div>'):s.html('<p class="text-center"></p>')}},!1),e},success:function(e){s.html(e),"add-producto"===d&&a[0].reset(),l.ajax.reload(null,!1)},error:function(){s.html("<script>Swal.fire('Ocurrio un error inesperado', 'Error', 'error');</script>")}}),!1})})}$(document).ready(function(){(l=$("#table-productos").DataTable({columnDefs:[{orderable:!1,className:"select-checkbox",targets:0}],select:{style:"single",selector:"td:first-child"},lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"All"],],order:[[1,"asc"]],dom:"Bfrtip",searching:!0,ordering:!1,ajax:{url:"./view/ajax/productos.php",dataSrc:"",data:{action:"listarproductos"},method:"POST"},columns:[{data:"contador"},{data:"idproducto"},{data:"categoria"},{data:"nombre"},{data:"descripcion"},{data:"precio"},{data:"stock"},{data:"imagen"},{data:"estado"}],language:{url:"./view/js/datatable-es.json"},responsive:!0})).on("select",function(e,t,a,i){"row"===a&&(d=l.rows(i).data()[0].idproducto)}),$("#open-modal-button").click(function(){s(e="agregar")}),$("#open-modal-editar").click(function(){r(d=d,e="editar")}),$("#open-modal-eliminar").click(function(){r(d=d,e="eliminar")})})}();
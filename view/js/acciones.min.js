!function(){var e;let t,a;function d(){for(var d=e.rows(".selected").data().toArray(),o=$("#productosSeleccionados").DataTable(),l=0;l<d.length;l++){var r=d[l];o.row.add([r.idproducto,r.nombre,r.precio,'<input type="number" id="'+r.idproducto+'" class="form-control cantidad" value="1" min="1" data-id="'+r.idproducto+'">','<p class="precio-total" data-precio="'+r.precio+'" data-id="'+r.idproducto+'">'+r.precio+"</p>",'<button class="btn btn-danger eliminarProductoBtn" data-id="'+r.idproducto+'">Eliminar</button>']).draw()}$("#productosSeleccionados").on("click",".eliminarProductoBtn",function(){o.row($(this).closest("tr")).remove().draw()}),$("#productosSeleccionados").on("change",'input[type="number"]',function(){var e=$(this).data("id"),t=parseInt($(this).val()),a=parseFloat($('p[data-id="'+e+'"]').data("precio"));console.log(a),$('p[data-id="'+e+'"]').text((t*a).toFixed(2))}),a.hide(),document.body.removeChild(t)}$(document).ready(function(){$("#productosSeleccionados").DataTable({searching:!1,ordering:!1,info:!1,deferRender:!0,scrollY:300,scrollCollapse:!0,scroller:!0,language:{url:"./view/js/datatable-es.json"},responsive:!0}),$("#productosModal").click(function(){(function o(){(t=document.createElement("div")).classList.add("modal","fade"),t.id="productosModal",t.setAttribute("data-bs-backdrop","static"),t.setAttribute("data-bs-keyboard","false"),t.setAttribute("tabindex","-1"),t.setAttribute("aria-hidden","true");let l=document.createElement("div");l.classList.add("modal-dialog","modal-dialog-centered","modal-dialog-scrollable");let r=document.createElement("div");r.classList.add("modal-content");let i=document.createElement("div");i.classList.add("modal-header");let n=document.createElement("h1");n.classList.add("modal-title","fs-5"),n.id="tituloLabel",n.textContent="Productos disponibles";let s=document.createElement("button");s.type="button",s.classList.add("btn-close"),s.setAttribute("data-bs-dismiss","modal"),s.setAttribute("aria-label","Close"),s.addEventListener("click",y);let c=document.createElement("div");c.classList.add("modal-body");let p=document.createElement("table");p.classList.add("table","table-striped"),p.id="tablaProductos";let u=document.createElement("thead"),b=document.createElement("tr");for(var m=["#","Codigo","Categoria","Nombre","Precio","Stock","Imagen"],h=0;h<m.length;h++){var v=document.createElement("th");v.classList.add("text-center"),v.textContent=m[h],b.appendChild(v)}let g=document.createElement("tbody"),f=document.createElement("div");f.classList.add("modal-footer");let C=document.createElement("button");C.type="button",C.classList.add("btn","btn-secondary"),C.setAttribute("data-bs-dismiss","modal"),C.textContent="Cancelar",C.addEventListener("click",y);let E=document.createElement("button");function y(){a.hide(),document.body.removeChild(t)}E.classList.add("btn","btn-success"),E.textContent="Agregar elementos",E.id="agregarProductosBtn",i.appendChild(n),i.appendChild(s),f.appendChild(C),f.appendChild(E),r.appendChild(i),r.appendChild(c),c.appendChild(p),p.appendChild(u),u.appendChild(b),p.appendChild(g),r.appendChild(f),l.appendChild(r),t.appendChild(l),document.body.appendChild(t),e=$("#tablaProductos").DataTable({columnDefs:[{orderable:!1,className:"select-checkbox",targets:0}],lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"All"],],ajax:{url:"./view/ajax/productos.php",dataSrc:"",data:{action:"listarproductosdisponibles"},method:"POST"},select:{style:"multi"},columns:[{data:"contador"},{data:"idproducto"},{data:"categoria"},{data:"nombre"},{data:"precio"},{data:"stock"},{data:"imagen"}],language:{url:"./view/js/datatable-es.json"},responsive:!0}),$("#agregarProductosBtn").click(d),(a=new bootstrap.Modal(t)).show()})()}),$("#save-venta").click(function(e){var t,a;e.preventDefault(),t=$("#clienteSelect").val(),a=function e(){for(var t=$("#productosSeleccionados").DataTable().rows().data().toArray(),a=[],d=0;d<t.length;d++){var o={id:t[d][0],cantidad:$("#"+t[d][0]).val()};a.push(o)}return a}(),$.ajax({url:"./view/ajax/productos.php",type:"POST",data:{cliente:t,productos:a,action:"guardarventa"},dataType:"json",success:function(e){"success"===e.status?(Swal.fire({icon:"success",title:e.message}),$("#clienteSelect").val($("#clienteSelect option:first").val()),$("#productosSeleccionados").DataTable().clear().draw()):Swal.fire({icon:"error",title:"Error al guardar la venta",text:e.message})},error:function(e,t,a){Swal.fire({icon:"error",title:"Error al guardar la venta",text:a})}})})})}();